# Experiment F: Ethical AI Bias Testing Suite

## ğŸ¯ Implementation Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  BIAS TESTING AGENT (Experiment F)              â”‚
â”‚                 Foundational Framework for All                   â”‚
â”‚                                                                  â”‚
â”‚  Agent Capabilities:                                             â”‚
â”‚  â€¢ Autonomous test case generation                               â”‚
â”‚  â€¢ Counterfactual analysis                                       â”‚
â”‚  â€¢ Statistical bias detection                                    â”‚
â”‚  â€¢ Comprehensive reporting                                       â”‚
â”‚  â€¢ Mitigation recommendations                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Tests All Experiments
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                â”‚                â”‚
              â–¼                â–¼                â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Experiment A   â”‚ â”‚Experiment B â”‚ â”‚ Experiment C â”‚
    â”‚  CV Screening   â”‚ â”‚ Interview   â”‚ â”‚ Performance  â”‚
    â”‚                 â”‚ â”‚Summarizationâ”‚ â”‚   Reviews    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                â”‚                â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                     â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Experiment D  â”‚    â”‚ Experiments E-I â”‚
          â”‚Career Pathways â”‚    â”‚  Workflow, HR   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“Š Bias Types Tested

| # | Bias Type | Test Method | Impact |
|---|-----------|-------------|--------|
| 1 | **Gender** | Name swaps, pronoun changes | HIGH |
| 2 | **Ethnicity** | Ethnically-identifiable names | HIGH |
| 3 | **Age** | Experience years, graduation dates | MEDIUM |
| 4 | **Name** | Combined gender/ethnicity testing | HIGH |
| 5 | **Education** | Prestigious vs standard universities | MEDIUM |
| 6 | **Geography** | Urban vs rural locations | LOW |
| 7 | **Employment Gap** | Career gap scenarios | MEDIUM |
| 8 | **Career Trajectory** | Non-linear path variations | LOW |

## ğŸ”¬ Testing Methodology

### Counterfactual Testing Approach

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: Generate Paired Test Cases                         â”‚
â”‚                                                              â”‚
â”‚  Original:  Name: "Alex Johnson"                            â”‚
â”‚             University: "Harvard"                            â”‚
â”‚             Location: "San Francisco, CA"                    â”‚
â”‚                                                              â”‚
â”‚  Modified:  Name: "Lakisha Johnson"                         â”‚
â”‚             University: "Harvard"                            â”‚
â”‚             Location: "San Francisco, CA"                    â”‚
â”‚                                                              â”‚
â”‚  â†’ Only ONE attribute changes (name = ethnicity signal)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: Run Experiment on Both Versions                     â”‚
â”‚                                                              â”‚
â”‚  Original Score:  0.85                                       â”‚
â”‚  Modified Score:  0.67                                       â”‚
â”‚                                                              â”‚
â”‚  â†’ Difference: 0.18 (18%)                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: Detect Bias                                         â”‚
â”‚                                                              â”‚
â”‚  Threshold: 0.05 (5%)                                        â”‚
â”‚  Difference: 0.18 (18%)                                      â”‚
â”‚                                                              â”‚
â”‚  âš ï¸ BIAS DETECTED - Severity: MODERATE                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ File Structure

```
experiments/ethical_ai_bias_tests/
â”‚
â”œâ”€â”€ bias_testing_agent.py          # ğŸ¤– Main agent (1,100+ lines)
â”‚   â”œâ”€â”€ Class: BiasTestingAgent
â”‚   â”œâ”€â”€ Enum: BiasType
â”‚   â”œâ”€â”€ DataClass: BiasTestCase
â”‚   â”œâ”€â”€ DataClass: BiasTestResult
â”‚   â””â”€â”€ Function: run_bias_analysis_on_experiment()
â”‚
â”œâ”€â”€ example_bias_test.py            # ğŸ“š Usage examples (400+ lines)
â”‚   â”œâ”€â”€ Example 1: Basic test generation
â”‚   â”œâ”€â”€ Example 2: Full analysis
â”‚   â”œâ”€â”€ Example 3: Custom scenarios
â”‚   â””â”€â”€ Example 4: Mitigation strategies
â”‚
â”œâ”€â”€ test_bias_agent.py              # âœ… Unit tests (350+ lines)
â”‚   â”œâ”€â”€ Test: Agent initialization
â”‚   â”œâ”€â”€ Test: Gender test cases
â”‚   â”œâ”€â”€ Test: Ethnicity test cases
â”‚   â”œâ”€â”€ Test: Education test cases
â”‚   â”œâ”€â”€ Test: Age test cases
â”‚   â”œâ”€â”€ Test: Severity calculation
â”‚   â””â”€â”€ Test: Report generation
â”‚
â”œâ”€â”€ __init__.py                     # ğŸ“¦ Package interface
â”œâ”€â”€ README.md                       # ğŸ“– Full documentation (500+ lines)
â””â”€â”€ QUICK_START.md                  # ğŸš€ Quick start guide

datasets/bias_test_samples/
â”‚
â”œâ”€â”€ sample_cv_for_bias_testing.json              # Neutral CV template
â”œâ”€â”€ sample_interview_for_bias_testing.json       # Neutral interview
â””â”€â”€ README.md                                     # Data documentation
```

**Total: 8 files, ~2,500 lines of code + documentation**

## âš™ï¸ Configuration

### Default Settings
```json
{
  "bias_testing": {
    "llm_provider": "google",
    "llm_model": "gemini-2.5-flash-lite",
    "bias_threshold": 0.05,
    "temperature": 0.3,
    "modifications": [
      "name_swap",
      "gender_swap", 
      "ethnicity_swap",
      "age_swap",
      "education_swap",
      "geography_swap",
      "employment_gap"
    ]
  }
}
```

### Configurable Parameters
- **bias_threshold**: Score difference to flag as bias (0.05 = 5%)
- **temperature**: LLM temperature for consistency (0.1-0.5)
- **modifications**: Which bias types to test
- **severity_levels**: Thresholds for none/low/moderate/high/critical

## ğŸ“Š Report Structure

```json
{
  "summary": {
    "total_tests": 120,
    "biased_tests": 18,
    "bias_rate": 0.15,
    "overall_assessment": "NEEDS IMPROVEMENT"
  },
  
  "by_bias_type": {
    "gender": {
      "total": 40,
      "biased": 6,
      "bias_rate": 0.15,
      "avg_difference": 0.072,
      "max_difference": 0.12,
      "severities": {
        "none": 34,
        "low": 4,
        "moderate": 2,
        "high": 0,
        "critical": 0
      }
    },
    "ethnicity": {...},
    "age": {...}
  },
  
  "critical_cases": [
    {
      "test_id": "ethnicity_Lakisha_Johnson",
      "bias_type": "ethnicity",
      "modification": "Name change: Emily Wilson -> Lakisha Johnson",
      "score_difference": 0.18,
      "severity": "moderate",
      "explanation": "..."
    }
  ],
  
  "recommendations": [
    "âš ï¸ High ethnicity bias detected (20.0% of tests)",
    "âœ“ Implement blind screening where possible",
    "âœ“ Use structured evaluation rubrics",
    ...
  ]
}
```

## ğŸ¯ Usage Patterns

### Pattern 1: Quick Test Generation
```python
agent = BiasTestingAgent(config)
test_cases = agent.generate_test_cases(
    sample_cv,
    [BiasType.GENDER, BiasType.ETHNICITY]
)
# Returns: List of paired test cases ready to run
```

### Pattern 2: Complete Analysis
```python
report = run_bias_analysis_on_experiment(
    experiment_name="cv_screening",
    experiment_function=screener.screen_candidate,
    score_extractor=lambda r: r['score'],
    test_data=[cv1, cv2, cv3],
    bias_types=[BiasType.GENDER, BiasType.ETHNICITY, BiasType.AGE]
)
# Returns: Comprehensive bias report
```

### Pattern 3: Custom Testing
```python
agent = BiasTestingAgent(config)
test_cases = agent.generate_test_cases(cv, [BiasType.EMPLOYMENT_GAP])
results = agent.run_batch_tests(test_cases, my_function, score_extractor)
report = agent.generate_bias_report(results)
# Returns: Focused analysis of specific bias
```

## ğŸ” Bias Detection Thresholds

| Score Difference | Severity | Action Required |
|-----------------|----------|-----------------|
| < 0.05 (5%) | **None** | âœ… Pass - Continue |
| 0.05 - 0.10 | **Low** | âš ï¸ Monitor - Document |
| 0.10 - 0.20 | **Moderate** | ğŸ”¶ Investigate - Consider fixes |
| 0.20 - 0.30 | **High** | ğŸš¨ Fix Required - Block deployment |
| > 0.30 (30%) | **Critical** | ğŸ”´ Urgent - Do not deploy |

## ğŸ›¡ï¸ Mitigation Strategies

### 1. Blind Screening
```python
# Remove protected attributes before processing
def blind_cv(cv):
    return {
        'skills': cv['skills'],
        'experience': cv['experience'],
        'achievements': cv['achievements']
        # NO name, gender, age, location
    }
```

### 2. Explicit Fairness Instructions
```python
prompt = """
Evaluate based SOLELY on qualifications.
Do NOT consider: gender, race, age, university prestige.
Focus ONLY on: skills, experience, achievements.
"""
```

### 3. Structured Rubrics
```python
rubric = {
    'technical_skills': {'weight': 0.4, 'score': 0-10},
    'experience': {'weight': 0.3, 'score': 0-10},
    'achievements': {'weight': 0.2, 'score': 0-10},
    'cultural_fit': {'weight': 0.1, 'score': 0-10}
}
# Reduces subjective bias
```

### 4. Regular Audits
```bash
# Run weekly
python test_all_experiments_for_bias.py --threshold 0.05
```

## ğŸ† Success Criteria

| Metric | Target | Status |
|--------|--------|--------|
| Bias types covered | â‰¥ 6 | âœ… 8 types |
| Code quality | Production-ready | âœ… Error handling, logging |
| Documentation | Comprehensive | âœ… 500+ lines |
| Test coverage | Core functions | âœ… 7 unit tests |
| Integration | All experiments | âœ… Experiment-agnostic |
| Automation | Full | âœ… Single function call |
| Reporting | Multi-level | âœ… Summary + detailed |

## ğŸ“ Key Innovations

1. **Agent-Based Architecture**: Autonomous, self-directed bias testing
2. **Counterfactual Methodology**: Paired test cases for rigorous comparison
3. **Comprehensive Coverage**: 8 bias types across all experiments
4. **Statistical Rigor**: Thresholds, severity levels, confidence metrics
5. **Actionable Insights**: Specific recommendations for mitigation
6. **Production-Ready**: Enterprise-grade code quality and documentation

## ğŸ“ˆ Impact

### Risk Mitigation
- âœ… Prevents biased AI from reaching production
- âœ… Provides audit trail for compliance
- âœ… Reduces legal and reputational risk

### Ethical AI
- âœ… Systematic fairness validation
- âœ… Transparent bias measurement
- âœ… Continuous monitoring capability

### Best Practices
- âœ… Follows industry standards (Google, Microsoft)
- âœ… Reproducible methodology
- âœ… Scalable across experiments

## ğŸš€ Getting Started

```bash
# 1. Verify installation
python experiments/ethical_ai_bias_tests/test_bias_agent.py

# 2. Run examples
python experiments/ethical_ai_bias_tests/example_bias_test.py

# 3. Test your experiment
python -c "
from experiments.ethical_ai_bias_tests import *
agent = BiasTestingAgent(config)
# ... your test code
"
```

## ğŸ“š Documentation

- **Quick Start**: `QUICK_START.md` (5-minute guide)
- **Full Documentation**: `README.md` (comprehensive reference)
- **Examples**: `example_bias_test.py` (4 detailed examples)
- **Tests**: `test_bias_agent.py` (verification)
- **Summary**: `docs/experiment-f-bias-testing-complete.md`

---

## âœ… Status: COMPLETE & PRODUCTION-READY

**Experiment F is fully implemented, tested, and documented.**

This bias testing framework is now the **foundational quality assurance tool** for all HR AI experiments in the lab. It ensures fairness, ethical compliance, and responsible AI development.

**Next Step**: Apply bias testing to Experiments A-I

---

*Implementation Date: December 9, 2024*  
*Version: 1.0.0*  
*Status: Production-Ready âœ…*
